
var program = require('commander');
var inquirer = require('inquirer');
const path = require('path');

const ora = require('ora');
const fetchRemotePreset = require('./downloadGitRepo');
const {fsExistsSync} = require('../util/tool');

program
    .version('0.0.1')
    .description('a test cli program')
    .option('-n, --name <name>', 'your name', 'GK')
    .option('-a, --age <age>', 'your age', '22')
    .option('-e, --enjoy [enjoy]');

program
    .command('install')
    .description('run remote setup commands')
    .action((options) => {
        let choices = [{
            name: 'pc',
            value: 'https://github.com:biuge/base-webpack-cli#pc'
        }, {
            name: 'mob',
            value: 'https://github.com:biuge/base-webpack-cli'
        }];
        let questions = [ {
            type: 'list',
            name: 'repo',
            message: 'which repo do you want to install?',
            choices
        }, {
            type: 'input',
            name: 'dir',
            message: 'project name',
            async validate( input ) {
                const done = this.async();
                if ( input.length === 0 ) {
                    done( '取个名谢谢!' );
                    return;
                }
                const dir = path.join( process.cwd(), input );
                if ( await fsExistsSync( dir ) ) {
                    done( '项目已存在,换个名字吧' );
                }
                done( null, true );
            }
        }];
        inquirer.prompt( questions )
            .then(answers => {
                const downStatus = ora('正在下载模板...');
                downStatus.start();
                fetchRemotePreset(answers.repo, answers.dir, true).then(err => {
                    if (!err) {
                        downStatus.fail();
                        console.log(err);
                    } else {
                        downStatus.succeed();
                        console.log('下载成功');
                    }
                });
            } );
    });
program.parse(process.argv);